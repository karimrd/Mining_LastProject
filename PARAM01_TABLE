*&---------------------------------------------------------------------*
*& Report  ZBW_UPDATE_PARAMS
*&
*&---------------------------------------------------------------------*
*&
*&
*&---------------------------------------------------------------------*
REPORT ZBW_UPD_ZTB_PARAM01.

TABLES: ZTB_PARAM01.

DATA: ZI_DTP TYPE RSBKDTPNM.


DATA: WA TYPE ZTB_PARAM01,
      T_PARAM01 LIKE TABLE OF ZTB_PARAM01.

  TYPES: BEGIN OF TY_DAYS,
           FECHA LIKE SY-DATUM,
           STATUS(1) TYPE C,
           INIYR LIKE SY-DATUM,
           INIMO LIKE SY-DATUM.
  TYPES: END OF TY_DAYS.

  TYPES: TAB_DAYS TYPE STANDARD TABLE OF TY_DAYS.

  DATA: GT_DAYS TYPE TAB_DAYS.
  DATA: WA_DAY LIKE LINE OF GT_DAYS.
  DATA: L_DAY TYPE SY-DATUM.

*&---------------------------------------------------------------------*
*&  Selection screen
*&---------------------------------------------------------------------*
* Define screen 101 as subscreen
*SELECTION-SCREEN BEGIN OF SCREEN 101 AS SUBSCREEN NESTING LEVEL 4.
*SELECTION-SCREEN: BEGIN OF BLOCK B00.
SELECTION-SCREEN: BEGIN OF BLOCK B00 WITH FRAME TITLE TEXT-B00.
********************* Carga manual ***********************

PARAMETERS: P_CMAN RADIOBUTTON GROUP UNO1. "Carga manual
*SELECTION-SCREEN: BEGIN OF BLOCK B01.
*SELECTION-SCREEN: BEGIN OF BLOCK B01 WITH FRAME.
SELECTION-SCREEN: BEGIN OF BLOCK B01 WITH FRAME TITLE TEXT-B01.
PARAMETERS: P_BORRAR TYPE C AS CHECKBOX.
PARAMETERS: P_INSERT TYPE C AS CHECKBOX.
SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN: COMMENT 1(15)  TEXT11.
SELECTION-SCREEN: COMMENT 16(15) TEXT12.
SELECTION-SCREEN: COMMENT 31(18) TEXT13.
SELECTION-SCREEN: COMMENT 49(25) TEXT14.
SELECTION-SCREEN END OF LINE.

SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN: COMMENT 1(15)  TEXT15.
SELECTION-SCREEN: COMMENT 16(15) TEXT16.
SELECTION-SCREEN: COMMENT 31(18) TEXT17.
SELECTION-SCREEN: COMMENT 49(25) TEXT18.
SELECTION-SCREEN END OF LINE.
SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN POSITION 1.
PARAMETERS: P_LOW1 LIKE ZTB_PARAM01-PARLOW.
SELECTION-SCREEN POSITION 16.
PARAMETERS: P_HIG1 LIKE ZTB_PARAM01-PARHIG.
SELECTION-SCREEN POSITION 31.
PARAMETERS: P_PER1 LIKE ZTB_PARAM01-PERIOD.
SELECTION-SCREEN POSITION 49.
PARAMETERS: P_TIP1 LIKE ZTB_PARAM01-TIPKPI.
SELECTION-SCREEN END OF LINE.

SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN POSITION 1.
PARAMETERS: P_LOW2 LIKE ZTB_PARAM01-PARLOW.
SELECTION-SCREEN POSITION 16.
PARAMETERS: P_HIG2 LIKE ZTB_PARAM01-PARHIG.
SELECTION-SCREEN POSITION 31.
PARAMETERS: P_PER2 LIKE ZTB_PARAM01-PERIOD.
SELECTION-SCREEN POSITION 49.
PARAMETERS: P_TIP2 LIKE ZTB_PARAM01-TIPKPI.
SELECTION-SCREEN END OF LINE.

SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN POSITION 1.
PARAMETERS: P_LOW3 LIKE ZTB_PARAM01-PARLOW.
SELECTION-SCREEN POSITION 16.
PARAMETERS: P_HIG3 LIKE ZTB_PARAM01-PARHIG.
SELECTION-SCREEN POSITION 31.
PARAMETERS: P_PER3 LIKE ZTB_PARAM01-PERIOD.
SELECTION-SCREEN POSITION 49.
PARAMETERS: P_TIP3 LIKE ZTB_PARAM01-TIPKPI.
SELECTION-SCREEN END OF LINE.

SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN POSITION 1.
PARAMETERS: P_LOW4 LIKE ZTB_PARAM01-PARLOW.
SELECTION-SCREEN POSITION 16.
PARAMETERS: P_HIG4 LIKE ZTB_PARAM01-PARHIG.
SELECTION-SCREEN POSITION 31.
PARAMETERS: P_PER4 LIKE ZTB_PARAM01-PERIOD.
SELECTION-SCREEN POSITION 49.
PARAMETERS: P_TIP4 LIKE ZTB_PARAM01-TIPKPI.
SELECTION-SCREEN END OF LINE.
PARAMETERS: P_MOSTRA TYPE C AS CHECKBOX.
SELECTION-SCREEN: END OF BLOCK B01.

********************* Carga automatizada ***********************
*SELECTION-SCREEN ULINE.

PARAMETERS: P_CAUTO RADIOBUTTON GROUP UNO1. "Carga automatizada
*SELECTION-SCREEN: BEGIN OF BLOCK B02.
SELECTION-SCREEN: BEGIN OF BLOCK B02 WITH FRAME TITLE TEXT-B02.
*SELECTION-SCREEN BEGIN OF LINE.
*PARAMETERS: P_AUTOM TYPE C AS CHECKBOX.
*SELECTION-SCREEN: COMMENT 1(40)  TEXT21.
*SELECTION-SCREEN END OF LINE.
*SELECTION-SCREEN ULINE.

*SELECTION-SCREEN BEGIN OF LINE.
*SELECTION-SCREEN: COMMENT 16(15) TEXT23.
*SELECTION-SCREEN: COMMENT 60(30) TEXT24.
**SELECTION-SCREEN: COMMENT 31(30) TEXT24.
**SELECTION-SCREEN: COMMENT 49(25) TEXT4.
*SELECTION-SCREEN END OF LINE.

*SELECTION-SCREEN BEGIN OF LINE.
*SELECTION-SCREEN: COMMENT 1(15)  TEXT24.
*SELECTION-SCREEN: COMMENT 16(15) TEXT25.
*SELECTION-SCREEN: COMMENT 31(18) TEXT27.
**SELECTION-SCREEN: COMMENT 49(25) TEXT8.
*SELECTION-SCREEN END OF LINE.

SELECT-OPTIONS: P_FECS FOR SY-DATUM.

*SELECTION-SCREEN ULINE.
SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN: COMMENT 1(30)  TEXT25.
SELECTION-SCREEN: COMMENT 38(30)  TEXT26.
SELECTION-SCREEN END OF LINE.

* Selección de cargas
SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN POSITION 1.
PARAMETERS: P_AVI TYPE C AS CHECKBOX. "Cumplimiento de avisos
SELECTION-SCREEN: COMMENT 3(15)  TEXT251.
SELECTION-SCREEN: COMMENT 30(3)  TEXT251L.
SELECTION-SCREEN POSITION 35.
PARAMETERS: P_AVI_LO(30) TYPE C.
SELECTION-SCREEN: COMMENT 66(3)  TEXT251H.
SELECTION-SCREEN POSITION 70.
PARAMETERS: P_AVI_HI(30) TYPE C.
SELECTION-SCREEN END OF LINE.
SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN POSITION 1.
PARAMETERS: P_ORD TYPE C AS CHECKBOX. "Cumplimiento de órdenes
SELECTION-SCREEN: COMMENT 3(15)  TEXT252.
SELECTION-SCREEN: COMMENT 30(3)  TEXT252L.
SELECTION-SCREEN POSITION 35.
PARAMETERS: P_ORD_LO(30) TYPE C.
SELECTION-SCREEN: COMMENT 66(3)  TEXT252H.
SELECTION-SCREEN POSITION 70.
PARAMETERS: P_ORD_HI(30) TYPE C.
SELECTION-SCREEN END OF LINE.
SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN POSITION 1.
PARAMETERS: P_P1 TYPE C AS CHECKBOX.  "Backlog / Frontlog / Precisión HH
SELECTION-SCREEN: COMMENT 3(30)  TEXT253.
SELECTION-SCREEN POSITION 35.
SELECT-OPTIONS: P_P1DTP FOR ZI_DTP NO-EXTENSION.
SELECTION-SCREEN END OF LINE.
SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN POSITION 1.
PARAMETERS: P_P2 TYPE C AS CHECKBOX. "MTBF / MTTR / Disponibilidad
SELECTION-SCREEN: COMMENT 3(30)  TEXT254.
SELECTION-SCREEN POSITION 35.
SELECT-OPTIONS: P_P2DTP FOR ZI_DTP NO-EXTENSION.
SELECTION-SCREEN END OF LINE.

SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN: COMMENT 1(30)  TEXT24.
*SELECTION-SCREEN: COMMENT 1(15)  TEXT92.
*PARAMETERS: P_FECINI LIKE ZTB_PARAM01-PARLOW.
*SELECTION-SCREEN POSITION 16.
*PARAMETERS: P_FECFIN LIKE ZTB_PARAM01-PARHIG.
SELECTION-SCREEN POSITION 38.
*SELECTION-SCREEN: COMMENT 60(2) TEXT23.
*SELECTION-SCREEN: COMMENT 60(10) TEXT24.
*SELECTION-SCREEN POSITION 60.
PARAMETERS: P_SECS(3) TYPE C DEFAULT '10'.
*PARAMETERS: P_PER1 LIKE ZTB_PARAM01-PERIOD.
*SELECTION-SCREEN POSITION 49.
*PARAMETERS: P_TIP1 LIKE ZTB_PARAM01-TIPKPI.
SELECTION-SCREEN END OF LINE.

SELECTION-SCREEN: END OF BLOCK B02.

PARAMETERS: P_OTR RADIOBUTTON GROUP UNO1. "Carga HORAS

SELECTION-SCREEN: BEGIN OF BLOCK B03 WITH FRAME TITLE TEXT-B03.
SELECT-OPTIONS: P_FECHAS FOR SY-DATUM.
SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN: COMMENT 1(30)  TEXT31.
SELECTION-SCREEN END OF LINE.
PARAMETERS: P_HRS TYPE C AS CHECKBOX. "Horas disponibles por equipo.
SELECTION-SCREEN: END OF BLOCK B03.

SELECTION-SCREEN: END OF BLOCK B00.
*SELECTION-SCREEN END OF SCREEN 101.

*SELECTION-SCREEN BEGIN OF SCREEN 102 AS SUBSCREEN  NESTING LEVEL 4.
*SELECTION-SCREEN END OF SCREEN 102.

* Define tab screen
*SELECTION-SCREEN BEGIN OF TABBED BLOCK T1 FOR 40 LINES.
*SELECTION-SCREEN TAB (30) NAME1 USER-COMMAND UCOMM1 DEFAULT SCREEN 101.
*SELECTION-SCREEN TAB (30) NAME2 USER-COMMAND UCOMM2 DEFAULT SCREEN 102.
**SELECTION-SCREEN TAB (30) NAME3 USER-COMMAND UCOMM3 DEFAULT SCREEN 103.
*SELECTION-SCREEN END OF BLOCK T1.

INITIALIZATION.

*NAME1 = 'Carga Manual'.  "Carga Manual
*NAME2 = 'Carga Autom'.   "Carga automatizada
*NAME3 = 'Carga Horas'.   "Carga Horas


TEXT11 = 'PARLOW'.
TEXT12 = 'PARHIGH'.
TEXT13 = 'PERIODO'.
TEXT14 = 'TIPO KPI'.
TEXT15 = '(Fecha Inicio)'.
TEXT16 = '(Fecha Fin)'.
TEXT17 = '(A-Año/M-Mes)'.
TEXT18 = '(AV-Aviso/OR-Orden)'.

*TEXT21 = 'Parámetros de carga'.
*TEXT22 = 'Fechas de Inicio'.
*TEXT23 = 'Fecha Fin'.
*TEXT22 = 'Fechas de carga'.
*TEXT23 = ' '.
TEXT24 = 'Segundos de espera entre fotos'.
TEXT25 = 'Elegir las cargas a realizar:'.
TEXT251 = 'Avisos'.
TEXT252 = 'Ordenes'.
TEXT253 = 'Backlog / Frontlog / Precisión'.
TEXT254 = 'MTBF / MTTR / Disponibilidad'.

TEXT251L = 'YTD'.
TEXT252L = 'YTD'.
*TEXT253L = 'YTD'.
*TEXT254L = 'YTD'.

TEXT251H = 'MTD'.
TEXT252H = 'MTD'.
*TEXT253H = 'MTD'.
*TEXT254H = 'MTD'.


TEXT26 = 'Ingresar los DTPs a utilizar:'.
*TEXT261 = 'Avisos'.
*TEXT262 = 'Ordenes'.
*TEXT263 = 'Backlog / Frontlog / Precisión'.
*TEXT264 = 'MTBF / MTTR / Disponibilidad'.

TEXT31 = 'Elegir las cargas a realizar:'.

*  NAME1 = TEXT-N01.   "Carga Manual
*  NAME2 = TEXT-N02.   "Carga automatizada
*  NAME3 = TEXT-N03.   "TRANSACTION ID

START-OF-SELECTION.


IF P_CMAN EQ 'X'.
  PERFORM EJECUTA_CARGA_MANUAL.
ENDIF.

IF P_CAUTO EQ 'X'.
  PERFORM CREAR_LISTA_DIAS.
  PERFORM EXECUTE_LOAD.
ENDIF.

IF P_OTR EQ 'X'.
  PERFORM CREAR_LISTA_DIAS_OTRAS.
  PERFORM EXECUTE_LOAD_OTRAS.
ENDIF.


FORM EJECUTA_CARGA_MANUAL.
    IF P_BORRAR EQ 'X'.
        PERFORM LIMPIAR_TABLA.
    ENDIF.

    IF P_INSERT EQ 'X'.
      PERFORM INSERT_NUEVOS.
    ENDIF.

    IF P_MOSTRA EQ 'X'.
      PERFORM MUESTRA_DATOS.
    ENDIF.

ENDFORM.

FORM LIMPIAR_TABLA.
  DELETE FROM ZTB_PARAM01.
  COMMIT WORK.
ENDFORM.

FORM INSERT_NUEVOS.


*   Agregar los datos nuevos
  WA-PARLOW = P_LOW1.
  WA-PARHIG = P_HIG1.
  WA-PERIOD = P_PER1.
  WA-TIPKPI = P_TIP1.

  INSERT ZTB_PARAM01 FROM WA.

  CLEAR: WA.
  WA-PARLOW = P_LOW2.
  WA-PARHIG = P_HIG2.
  WA-PERIOD = P_PER2.
  WA-TIPKPI = P_TIP2.
  INSERT ZTB_PARAM01 FROM WA.

  CLEAR: WA.
  WA-PARLOW = P_LOW3.
  WA-PARHIG = P_HIG3.
  WA-PERIOD = P_PER3.
  WA-TIPKPI = P_TIP3.
  INSERT ZTB_PARAM01 FROM WA.

  CLEAR: WA.
  WA-PARLOW = P_LOW4.
  WA-PARHIG = P_HIG4.
  WA-PERIOD = P_PER4.
  WA-TIPKPI = P_TIP4.
  INSERT ZTB_PARAM01 FROM WA.

*  WA-PARLOW = P_LOW1.
*  WA-PARHIG = P_HIG1.
*  WA-PERIOD = P_PER1.
*  WA-TIPKPI = P_TIP1.

  COMMIT WORK.
ENDFORM.

FORM MUESTRA_DATOS.
  SELECT *
  FROM ZTB_PARAM01
  INTO CORRESPONDING FIELDS OF TABLE T_PARAM01.

  IF SY-SUBRC EQ 0.
    WRITE: / 'PARLOW    ', 'PARHIG    ', 'PERIOD ', 'TIPKPI'.
    WRITE /.

  LOOP AT T_PARAM01 INTO WA.
    WRITE: / WA-PARLOW, WA-PARHIG, WA-PERIOD, '      ', WA-TIPKPI.
  ENDLOOP.
  ELSE.
    WRITE: / 'No hay datos'.
  ENDIF.
ENDFORM.

FORM CREAR_LISTA_DIAS.
  "Crea la lista de dias a procesar.
  CLEAR: L_DAY, WA_DAY.
  REFRESH: GT_DAYS.

*  IF P_FECINI IS INITIAL OR
*     P_FECFIN IS INITIAL.
  IF P_FECS IS INITIAL.
     MESSAGE I000(38) WITH ' Especificar rango de fechas válido ' .
  ELSE.
*    L_DAY = P_FECINI.
*    WHILE L_DAY LE P_FECFIN.
    clear: l_day.
    LOOP AT P_FECS.
      L_DAY = P_FECS-LOW.
      WHILE L_DAY LE P_FECS-HIGH.
        WA_DAY-FECHA = L_DAY.
        "WA_DAY-STATUS
        CONCATENATE L_DAY(4) '0101' INTO WA_DAY-INIYR.
        CONCATENATE L_DAY(6) '01' INTO WA_DAY-INIMO.
        APPEND WA_DAY TO GT_DAYS.
        L_DAY = L_DAY + 1.
      ENDWHILE.
    ENDLOOP.
  ENDIF.

ENDFORM.

FORM CREAR_LISTA_DIAS_OTRAS.
  "Crea la lista de dias a procesar.
  CLEAR: L_DAY, WA_DAY.
  REFRESH: GT_DAYS.

  IF P_FECHAS IS INITIAL.
     MESSAGE I000(38) WITH ' Especificar rango de fechas válido ' .
  ELSE.
    L_DAY = P_FECHAS-LOW.
    WHILE L_DAY LE P_FECHAS-HIGH.
       WA_DAY-FECHA = L_DAY.
       "WA_DAY-STATUS
       CONCATENATE L_DAY(4) '0101' INTO WA_DAY-INIYR.
       CONCATENATE L_DAY(6) '01' INTO WA_DAY-INIMO.
       APPEND WA_DAY TO GT_DAYS.
       L_DAY = L_DAY + 1.
    ENDWHILE.
  ENDIF.

ENDFORM.


FORM EXECUTE_LOAD.

* Llena las lineas con los datos de gt_days
    LOOP AT GT_DAYS INTO WA_DAY.

* Limpiar la tabla
      DELETE FROM ZTB_PARAM01.
      COMMIT WORK.

* Llena los parametros
        WA-PARLOW = WA_DAY-INIYR.
        WA-PARHIG = WA_DAY-FECHA.
        WA-PERIOD = 'A'.
        WA-TIPKPI = 'AV'.
        INSERT ZTB_PARAM01 FROM WA.

        WA-PARLOW = WA_DAY-INIMO.
        WA-PARHIG = WA_DAY-FECHA.
        WA-PERIOD = 'M'.
        WA-TIPKPI = 'AV'.
        INSERT ZTB_PARAM01 FROM WA.

        WA-PARLOW = WA_DAY-INIYR.
        WA-PARHIG = WA_DAY-FECHA.
        WA-PERIOD = 'A'.
        WA-TIPKPI = 'OR'.
        INSERT ZTB_PARAM01 FROM WA.

        WA-PARLOW = WA_DAY-INIMO.
        WA-PARHIG = WA_DAY-FECHA.
        WA-PERIOD = 'M'.
        WA-TIPKPI = 'OR'.
        INSERT ZTB_PARAM01 FROM WA.

        COMMIT WORK.

* Ejecuta los DTP para foto YTD.
        IF P_AVI EQ 'X'.
*          PERFORM EXECUTE_DTP USING 'DTP_8KSJNQ5UR78X9437T0HS3L92A'. "0NOTIFICATN -> ZPM_CK01
*          PERFORM EXECUTE_DTP USING P_AVI_LO. "0NOTIFICATN -> ZPM_CK01
        ENDIF.
        IF P_ORD EQ 'X'.
*          PERFORM EXECUTE_DTP USING 'DTP_8KSJNQ5UR78YZEJEYAYRREAQO'. "0PM_ORDER -> ZPM_CK03
          PERFORM EXECUTE_DTP USING P_ORD_LO. "0PM_ORDER -> ZPM_CK03
        ENDIF.
        IF P_P1 EQ 'X'.
*          PERFORM EXECUTE_DTP USING 'DTP_8KSJNQ5UR78Z2NN6FF25NY6HN'. "0PM_C04 -> ZPM_CK13
          PERFORM EXECUTE_DTP USING P_P1DTP-LOW. "0PM_C04 -> ZPM_CK13
        ENDIF.
        IF P_P2 EQ 'X'.
*          PERFORM EXECUTE_DTP USING 'DTP_8KSJNQ5UR78YZJGPC38IJMJ87'. "0PM_DS01 -> ZPM_CK22
          PERFORM EXECUTE_DTP USING P_P2DTP-LOW. "0PM_DS01 -> ZPM_CK22
        ENDIF.
*        WAIT UP TO 20 SECONDS.
        WAIT UP TO P_SECS SECONDS.

* Ejecuta los DTP para foto MTD.

        IF P_AVI EQ 'X'.
*          PERFORM EXECUTE_DTP USING 'DTP_8KSJNQ5UR78YZGPMHPZO56USM'. "ZPM_CK01 -> ZPM_CK01
*          PERFORM EXECUTE_DTP USING P_AVI_HI. "ZPM_CK01 -> ZPM_CK01
        ENDIF.

        IF P_ORD EQ 'X'.
*          PERFORM EXECUTE_DTP USING 'DTP_8KSJNQ5UR78X969K8FY3X0VGU'. "ZPM_CK03 -> ZPM_CK03
          PERFORM EXECUTE_DTP USING P_ORD_HI.        "ZPM_CK03 -> ZPM_CK03
        ENDIF.

        IF P_P1 EQ 'X'.
*         PERFORM EXECUTE_DTP USING 'DTP_8KSJNQ5UR78XC7VCV4T5K1YDF'. "ZPM_CK13 -> ZPM_CK13
         PERFORM EXECUTE_DTP USING P_P1DTP-HIGH. "ZPM_CK13 -> ZPM_CK13
        ENDIF.

        IF P_P2 EQ 'X'.
*          PERFORM EXECUTE_DTP USING 'DTP_8KSJNQ5UR78XC7VDXW116HXBD'. "ZPM_CK22 -> ZPM_CK22
          PERFORM EXECUTE_DTP USING P_P2DTP-HIGH.  "ZPM_CK22 -> ZPM_CK22
        ENDIF.

    ENDLOOP.

*   Limpia la tabla para la carga dia a dia.
    DELETE FROM ZTB_PARAM01.
    COMMIT WORK.

ENDFORM.

FORM EXECUTE_LOAD_OTRAS.

* Llena las lineas con los datos de gt_days
    LOOP AT GT_DAYS INTO WA_DAY.

* Limpiar la tabla
      DELETE FROM ZTB_PARAM01.
      COMMIT WORK.

* Llena los parametros
        WA-PARLOW = WA_DAY-FECHA.
        WA-PARHIG = WA_DAY-FECHA.
        WA-PERIOD = 'D'.
        WA-TIPKPI = 'HR'.
        INSERT ZTB_PARAM01 FROM WA.

        COMMIT WORK.

* Ejecuta los DTP para la carga por dia
        IF P_HRS EQ 'X'.
          PERFORM EXECUTE_DTP USING 'DTP_8KSJNQ5UR78XCGZPILMMH8ACD'. "0EQUIPMENT -> ZPM_EQ03
        ENDIF.

        WAIT UP TO 30 SECONDS.

    ENDLOOP.

*   Limpia la tabla para la carga dia a dia.
    DELETE FROM ZTB_PARAM01.
    COMMIT WORK.

ENDFORM.


FORM EXECUTE_DTP USING I_DTP TYPE RSBKDTPNM.

      DATA: CLAS_DTP TYPE REF TO CL_RSBK_DTP,
            DTP_REQ TYPE REF TO CL_RSBK_REQUEST.
*            PA_DTP TYPE RSBKDTPNM.

*PARAMETERS: PA_DTP TYPE RSBKDTPNM.

*CLAS_DTP = CL_RSBK_DTP=>FACTORY( PA_DTP ).
CLAS_DTP = CL_RSBK_DTP=>FACTORY( I_DTP ).

TRY.
  CALL METHOD CLAS_DTP->IF_RSBK_DTP_EXECUTE~CREATE_REQUEST
     RECEIVING
     R_R_REQUEST = DTP_REQ.

  CALL METHOD DTP_REQ->IF_RSBK_REQUEST~DOIT
    EXPORTING
      I_NO_COMMIT = RS_C_FALSE.

  CATCH CX_RS_NOT_FOUND.
  CATCH CX_RS_FAILED.
  CATCH CX_RS_FOREIGN_LOCK.
ENDTRY.

*MESSAGE S000(38) WITH ' DTP ' PA_DTP 'scheduled / started sucesfully'.
MESSAGE S000(38) WITH ' DTP ' I_DTP 'scheduled / started sucesfully'.
ENDFORM.
